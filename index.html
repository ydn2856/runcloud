<!DOCTYPE html>
<html>
<head>
  <!-- Site made with Mobirise Website Builder v3.6.5, https://mobirise.com -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v3.6.5, mobirise.com">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="assets/images/14569042-1070759393019482-666066530-n.gif" type="image/x-icon">
  <meta name="description" content="">
  <title>討論區</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic&amp;subset=latin">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600,700,800,900">
  <link rel="stylesheet" href="assets/et-line-font-plugin/style.css">
  <link rel="stylesheet" href="assets/bootstrap-material-design-font/css/material.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/socicon/css/socicon.min.css">
  <link rel="stylesheet" href="assets/animate.css/animate.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">




  <link href="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.2/summernote.css" rel="stylesheet">


  <style>
      a.list-group-item{
        border-left: 0 none;
        border-right: 0 none;
        padding: 1.25rem 2.35rem;
        font-size: 1.5rem;
      }
      body{
        max-width: 100%;
        overflow-x: hidden;
        font-family: Roboto,Helvetica Neue,Helvetica,Arial,PingFang TC,黑體-繁,Heiti TC,蘋果儷中黑,Apple LiGothic Medium,微軟正黑體,Microsoft JhengHei,sans-serif;
      }
      @media (min-width: 992px){
        .col-lg-6 {
          padding-left: 3rem;
          padding-right: 3rem;
        }
      }
      #btn_new{
        font-size: 1.75rem;
        padding: 0 1.15rem;
        background-color: #3397cf;
        color: #fff;
      }
      #btn_new:hover{
        background-color: #006aa6;
      }
      #btn_cancel{
        font-size: 1.75rem;
        padding: 0 1.15rem;
        background-color: transparent;
        color:#ababae;
      }
      #btn_cancel:hover{
        color: #232323;
      }
      .note-popover.popover {
          display: none;
      }
      .note-editor.note-frame .note-editing-area .note-editable {
          background-color: transparent;
      }
	  .list-group-item{
		  background-color: transparent;
	  }
    .article-header{
      padding-top: 1rem;
    }
    .article-account{
      color: #1f2d39;
      font-size: 16px;
      float:left;
      margin-left:4%;
    }
    .article-contain{
      padding-top: 1.8rem;
      margin-left: 4%;
    }
    .comment-main{
      padding: 60px 0;
      text-align: left;
      margin-left: 4%;
    }
    .count-comment{
      font-size: 16px;
      line-height: 22px;
      color: #909090;
      font-weight: 400;
      margin: 0;
      border-bottom: 1px solid #dfdfdf;
    }
    .comment-contain{
      padding: 24px 0;
      border-bottom: 1px solid #dfdfdf;
    }
    .comment-header{
      font-size: 2.5rem;
      color: #1f2d39;
    }
    .comment-text{
      font-size: 18px;
      line-height: 30px;
      padding: 24px 0 0;
      word-break: break-word;
    }
  </style>


</head>
<body style="background-color:#00324e">
<section id="page2-menu-0">

    <nav class="navbar navbar-dropdown navbar-fixed-top">
        <div class="container">

            <div class="mbr-table">
                <div class="mbr-table-cell">

                    <div class="navbar-brand">
                        <a href="#" class="navbar-logo"><img src="assets/images/14569042-1070759393019482-666066530-n.gif"></a>
                        <a class="navbar-caption">RUNCLOUD</a>
                    </div>

                </div>
                <div class="mbr-table-cell">
                    <button class="navbar-toggler pull-xs-right hidden-md-up" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar">
                        <div class="hamburger-icon"></div>
                    </button>
                    
                    <ul class="nav-dropdown collapse pull-xs-right nav navbar-nav navbar-toggleable-sm" id="exCollapsingNavbar">
                        <li class="nav-item">
                            <a class="nav-link link" href="index.html" aria-expanded="false">討論板</a>
                        </li>
                        <li class="nav-item dropdown open">
                            <a class="nav-link link dropdown-toggle" data-toggle="dropdown-submenu" href="ranking.html" aria-expanded="true">排行榜</a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="ranking.html">校際排行</a>
                                <a class="dropdown-item" href="rank_person.html">校內排行</a>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link link" href="record.html" aria-expanded="false">紀錄</a>
                        </li>
                        <li class="nav-item">
                            <a id="login_btn" class="nav-link link" href="login.html" aria-expanded="false">登入</a>
                        </li>
                    </ul>

                    <button hidden="" class="navbar-toggler navbar-close" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar">
                        <div class="close-icon"></div>
                    </button>

                </div>
            </div>

        </div>
    </nav>

</section>

<section style="padding-top:90px">
      <div class="row">
          <div class="col-md-8 col-xs-12 col-lg-6 col-md-offset-2 col-lg-offset-3"style="background-color:#fafafa;">
              <div class="page-header" style="padding-top:2rem">
                <p id="title_text" align="center" style="float:left;margin-left:4%;font-size: 2rem;">全部</p>
                <h4 style="float:right"><button class="btn btn-default-lg" id="btn_new" onclick=new_article() style="float:left"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>發文</button><button style="float:right;display:none;margin-left:5px" onclick="cancel()" id="btn_cancel" class="btn btn-default-lg">X</button></h4>
              </div>
          </div>
      </div>
      <!-- /.row -->
      <div class="row" id="article_list" style="display:block">
          <div class="col-md-8 col-xs-12 col-lg-6 col-md-offset-2 col-lg-offset-3" id="list" style="background-color:#fafafa">
            <div id="list">

            </div>
          </div>
      </div>
</section>

<section id="new" style="display:none">
    <div class="row">
        <div id="new_article" class="col-md-8 col-xs-12 col-lg-6 col-md-offset-2 col-lg-offset-3"style="background-color:#fafafa;">
            <div>
                <input type="text" placeholder="請輸入標題" id="new_title" style="width:65%;font-size:2.5rem;margin-bottom:15px;border:0;background-color:transparent;margin-left:4%">
            </div>
            <div id="summernote"></div>
        </div>
    </div>
</section>

<session id="article_main" style="display:none">
  <div class="row">
      <div class="col-md-8 col-xs-12 col-lg-6 col-md-offset-2 col-lg-offset-3"style="background-color:#fafafa;">
          <div class="article-header">
            <h1 id="article_title" align="center" style="float:left;margin-left:4%;">標題</h1>
            <h4 style="float:right"><button class="btn btn-default-lg" id="btn_class" onclick=goto_class() style="float:left"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>類別</button></h4>
          </div>
      </div>
  </div>
  <div class="row">
      <div class="col-md-8 col-xs-12 col-lg-6 col-md-offset-2 col-lg-offset-3"style="background-color:#fafafa;">
          <div class="article-contain">

          </div>
      </div>
  </div>
  <div class="row">
      <div class="col-md-8 col-xs-12 col-lg-6 col-md-offset-2 col-lg-offset-3"style="background-color:#fafafa;">
          <div class="comment-main">
            <h3 id="count_comment" class="count-comment">共1則回應</h3>
            <div id="comment_list">

            </div>
            <div style="height:100px">
                <div style="padding: 2rem 0 3.5rem;border-bottom: 1px solid #efefef;">
                    <p id="comment_acc" align="center" style="float:left;font-size: 2rem;">account</p>
                    <h4 style="float:right"><button class="btn btn-default-lg" id="btn_comment" onclick="new_comment()" style="float:left"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>留言</button></h4>
                </div>
            </div>
            <div id="com_summernote">
            </div>
          </div>
      </div>
  </div>
</session>

  <section class="engine"></section>
  <script src="assets/web/assets/jquery/jquery.min.js"></script>
  <script src="assets/tether/tether.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/smooth-scroll/SmoothScroll.js"></script>
  <script src="assets/viewportChecker/jquery.viewportchecker.js"></script>
  <script src="assets/dropdown/js/script.min.js"></script>
  <script src="assets/touchSwipe/jquery.touchSwipe.min.js"></script>
  <script src="assets/theme/js/script.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.2/summernote.js"></script>
  <script src="js/login.js"></script>
  <script>
    var status;
    var acc;
    var pass;
    var json;
    var article_id;
    var comment_json;
    $(function(){
      status = $.UrlParam("v");
      acc=$.UrlParam("acc");
      pass=$.UrlParam("pass");
      //if(status==0){alert("登入成功")}
      if(status==4){alert("註冊成功，請重新登入")}
      if(!(acc===null)&&!(pass===null)){
        login_action(acc,pass);
      }
      var t=check_login(0);
      if(t=="yes"){
        $("#login_btn").text("登出");
        $("#login_btn").attr("href","#");
        $("#login_btn").click(function(){
          window.location.href="login.html?logout=0";
        });
      }
      getlist();
    });
    $(document).ready(function() {
        $('#summernote').summernote({
            height: 600,
            minHeight: 600,
            maxHeight: 600,
            toolbar: [
              //['misc', ['fullscreen']]
            ],
            disableDragAndDrop: true,
            shortcuts: false,
        });
        $('#com_summernote').summernote({
            height: 200,
            minHeight: 200,
            maxHeight: 200,
            toolbar: [
              //['misc', ['fullscreen']]
            ],

        });
        $('#com_summernote').summernote('fontSize', 18);
    });
    function new_article(){
       check_login(1);
       $("#btn_cancel").attr("style","float:right;display:block;margin-left:5px");
       $("#list").attr("style","display:none");
       $("#new").attr("style","display:block");
       $('#summernote').summernote('fontSize', 18);
       $("#btn_new").text("送出");
       $("#btn_new").attr("onclick","send()");
    }
    function cancel(){
        $("#btn_cancel").attr("style","float:right;display:none;margin-left:5px");
        $("#list").attr("style","display:block");
        $("#new").attr("style","display:none");
        $('#summernote').summernote('reset');
        $("#new_title").val("");
        $("#btn_new").text("發文");
        $("#btn_new").attr("onclick","new_article()");
        window.location.reload();
    }
    function send(){
       var num = $('#summernote').summernote('code').replace(/(<([^>]+)>)/ig, "").replace(/( )/, " ").length-1;
       if($("#new_title").val()==""){
         alert("請輸入標題！")
       }else if (num<15) {
         alert("內容須滿15字！")
       }else {
         //console.log(num);
         var markupStr = $('#summernote').summernote('code');
         //console.log(markupStr);
         post(markupStr);
         cancel();
         window.location.reload();
       }
    }
    function post(markupStr){
      var d = new Date();
      var time = d.getFullYear()+"-"+d.getMonth()+"-" + d.getDay()+" " +d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
      console.log(markupStr);
      //$.post("api/article.php", { account:get_acc() , text: markupStr,time:time,_class:"all",title:$("#new_title").val()} );
    $.ajax({
            url: "api/article.php",
            type: "POST",
			data:{ account:get_acc() , text: markupStr,time:time,_class:"all",title:$("#new_title").val()},
            dataType: "text",
            success: function(data) {
                console.log(data);
            }
      });
    }
    function getlist(){
      $.ajax({
            url: "api/article_list.php",
            type: "POST",
            dataType: "json",
            success: function(data) {
                console.log(data);
                json=data;
                reset(data);
            }
      });
    }
    function reset(data){
      $("#list").empty();
      for (var i = 0; i < data.length; i++) {
          $("#list").append('<a href="javascript:void(0)" onclick="show_article('+ i +')" class="list-group-item" id='+data[i]["article_id"]+'>'+data[i]["title"]+'</a>')
      }
    }
    function show_article(order){
      article_id=order+1;
      $("#btn_new").attr("style","float:left;display:none;");
      $("#btn_cancel").attr("style","float:right;display:block;margin-left:5px");
      $("#btn_cancel").attr("onclick","back()");
      $("#article_list").attr("style","display:none");
      $("#article_main").attr("style","display:block");
      $("#title_text").attr("class","article-account");
      $("#title_text").attr("style","");
      $(".article-contain").empty();
      if(get_acc()===null){
        $("#comment_acc").text("訪客無法留言");
      }else{
        $("#comment_acc").text(get_acc());
      }
        $("#title_text").text(json[order]["account"]);
        $("#article_title").text(json[order]["title"]);
        $("#btn_class").text(json[order]["class"]);
        $(".article-contain").append(json[order]["textmessage"]);
        //console.log(json[order]["textmessage"]);
      get_comment_list();
    }
    function back(){
      $("#btn_new").attr("style","float:left;display:block;");
      $("#btn_cancel").attr("style","float:right;display:none;margin-left:5px");
      $("#btn_cancel").attr("onclick","cancel()");
      $("#title_text").attr("class","");
      $("#title_text").attr("style","float:left;margin-left:4%;font-size: 2rem;");
      $("#title_text").text("全部");
      $("#article_list").attr("style","display:block");
      $("#article_main").attr("style","display:none");
    }
    function new_comment(){
      check_login(1);
      var markupStr = $('#com_summernote').summernote('code');
      com_post(markupStr);
      show_article(article_id-1);
    }
    function com_post(markupStr){
      var d = new Date();
      var time = d.getFullYear()+"-"+d.getMonth()+"-" + d.getDay()+" " +d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
      console.log(markupStr);
      //$.post("api/article.php", { account:get_acc() , text: markupStr,time:time,_class:"all",title:$("#new_title").val()} );
      $.ajax({
        async:false,
              url: "api/comment.php",
              type: "POST",
  			data:{ account:get_acc() , text: markupStr,time:time,article_id:article_id},
              dataType: "text",
              success: function(data) {
                  //console.log(data);
              }
        });
        $('#com_summernote').summernote('reset');
    }
    function get_comment_list(){
      $.ajax({
            url: "api/comment_list.php",
            type: "POST",
            data:{article_id:article_id},
            dataType: "json",
            success: function(data) {
                console.log(data);
                comment_json=data;
                comment_reset(data);
            }
      });
    }
    function comment_reset(data){
        $("#comment_list").empty();
        $("#count_comment").text("共有 "+data.length+" 則回應")
        for (var i = 0; i < data.length; i++) {
          var str='<div class="comment-contain"><div class="comment-header">'+data[i]["account"]+'</div><div class="comment-text">'+data[i]["textmessage"]+'</div></div>';
          $("#comment_list").append(str);
        }
    }
  </script>
  <input name="animation" type="hidden">
  </body>
</html>
